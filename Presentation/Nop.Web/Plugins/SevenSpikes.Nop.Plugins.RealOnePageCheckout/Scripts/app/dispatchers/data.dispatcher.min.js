function dataDispatcher(n,t,i,r){function f(t){n.$broadcast("refresh",{controller:t})}function o(t){e.pop(t);e.length===0&&n.$broadcast("resetOrderTotalData")}function nt(){if(s.length>0){var n=s.pop();n()}}function tt(){if(h.length>0){var n=h.pop();n()}}function a(n){var r=!1,i,t;if(n&&u&&u.addressTypeOnWhichTheTaxIsBasedOn=="BillingAddress"&&u.ajaxUpdateOrderTotalBasedOnTaxAddressOnAddressFieldsChange.length>0){if(n.newVatNumber!=undefined)return!0;for(i=u.ajaxUpdateOrderTotalBasedOnTaxAddressOnAddressFieldsChange,t=0;t<i.length;t++)if(n.hasOwnProperty("new"+i[t])){r=!0;break}}return r}function v(n){var r=!1,i,t;if(n&&u&&u.ajaxUpdatePaymentMethodsOnAddressFieldsUpdate.length>0)for(i=u.ajaxUpdatePaymentMethodsOnAddressFieldsUpdate,t=0;t<i.length;t++)if(n.hasOwnProperty("new"+i[t])){r=!0;break}return r}function y(){return u&&u.ajaxUpdateOrderTotalOnPaymentMethodsUpdate}function p(n){return n?n.useMyRewardPoints!=undefined:!1}function w(n){return n?Boolean(n.isMyRewardPointsChecked||n.useMyRewardPoints!=undefined||n.error):!1}function b(n){var r=!1,i,t;if(n&&u&&u.addressTypeOnWhichTheTaxIsBasedOn=="ShippingAddress"&&u.ajaxUpdateOrderTotalBasedOnTaxAddressOnAddressFieldsChange.length>0)for(i=u.ajaxUpdateOrderTotalBasedOnTaxAddressOnAddressFieldsChange,t=0;t<i.length;t++)if(n.hasOwnProperty("new"+i[t])){r=!0;break}return r}function k(n){var r=!1,i,t;if(n&&u&&u.ajaxUpdateShippingMethodsOnAddressFieldsUpdate.length>0)for(i=u.ajaxUpdateShippingMethodsOnAddressFieldsUpdate,t=0;t<i.length;t++)if(n.hasOwnProperty("new"+i[t])){r=!0;break}return r}function d(){return u&&u.ajaxUpdateOrderTotalOnShippingMethodsUpdate}function g(n){return n?n.hasPriceAdjustment:!1}function it(n){return n?n.hasPriceAdjustment:!1}function rt(n){if(n&&n.newShippingMethodSelected&&n.oldShippingMethodSelected){var t=n.newShippingMethodSelected.shippingOption.rate-n.oldShippingMethodSelected.shippingOption.rate;if(t!==0)return!0}return!1}var u,e=i,s=[],h=[],c=!1,l=!1;return r.getCheckoutData(),n.$on("checkoutDataLoaded",function(t,i){u=i.configuration;n.$broadcast("hideConfirmOrderOverlay");setTimeout(function(){$(".ropc select.not-loaded").removeClass("not-loaded");$.event.trigger("nopOnePageCheckoutPanelsLoadedEvent")})}),n.$on("addressChanged",function(t,i){n.$broadcast("prepareDefaultSelectedValuesForCustomAddressAttributes",{panel:i.panel,shipToSameAddress:i.shipToSameAddress})}),n.$on("shipToSameAddress",function(t,i){i&&angular.isDefined(i.shipToSameAddress)&&n.$broadcast("togglePanel",{shipToSameAddress:i.shipToSameAddress});i&&angular.isDefined(i.currentBillingAddress)&&i.shipToSameAddress&&n.$broadcast("updateShippingAddress",{address:angular.copy(i.currentBillingAddress)})}),n.$on("billingContextChanging",function(n,i){var r=a(i),u=v(i);r&&e.push("billingContextChanging");(r||u)&&t.raiseEvents(["setBillingAddressOverlay"]);u&&t.raiseEvents(["setPaymentMethodsOverlay"]);r&&t.raiseEvents(["setOrderTotalOverlay"])}),n.$on("billingContextChanged",function(t,i){var r=a(i),u=v(i);r&&o("billingContextChanging");u&&n.$broadcast("resetPaymentMethodsData",{newCountryId:i.newCountryId});i&&i.newVatNumber!=undefined&&n.$broadcast("resetOrderTotalData");f("BillingAddressController")}),n.$on("shippingContextChanging",function(n,i){var u=k(i),r=b(i);r&&e.push("shippingContextChanging");(u||r)&&t.raiseEvents(["setShippingAddressOverlay"]);u&&t.raiseEvents(["setShippingMethodsOverlay"]);r&&t.raiseEvents(["setOrderTotalOverlay"])}),n.$on("shippingContextChanged",function(t,i){i&&(b(i)&&o("shippingContextChanging"),k(i)&&n.$broadcast("resetShippingMethodsData",{newCountryId:i.newCountryId}),f("ShippingAddressController",{newCountryId:i.newCountryId}))}),n.$on("paymentMethodsContextChanging",function(n,i){c=!1;(y()||p(i))&&(e.push("paymentMethodsContextChanging"),t.raiseEvents(["setOrderTotalOverlay"]));w(i)&&t.raiseEvents(["setPaymentMethodsOverlay"])}),n.$on("paymentMethodsContextChanged",function(t,i){c=!0;(y()||p(i))&&(o("paymentMethodsContextChanging"),nt());w(i)&&n.$broadcast("resetPaymentMethodsData");f("PaymentMethodsController")}),n.$on("shippingMethodsContextChanging",function(){l=!1;d()&&(e.push("shippingMethodsContextChanging"),t.raiseEvents(["setOrderTotalOverlay"]));t.raiseEvents(["setShippingMethodsOverlay"])}),n.$on("shippingMethodsContextChanged",function(i,r){l=!0;rt(r)&&(n.$broadcast("resetPaymentMethodsData"),t.raiseEvents(["setPaymentMethodsOverlay"]));d()&&(o("shippingMethodsContextChanging"),tt());f("ShippingMethodsController")}),n.$on("orderSummaryContextChanging",function(n,i){if(e.push("orderSummaryContextChanging"),i&&(i.updateCartItem||i.removeCartItem)){var r=["setOrderSummaryOverlay","setPaymentMethodsOverlay","setOrderTotalOverlay"];(u.ajaxUpdateShippingMethodsOnCartUpdate||i.removeCartItem)&&r.push("setShippingMethodsOverlay");i.removeCartItem&&r.push("setCheckoutAttributesOverlay");t.raiseEvents(r)}}),n.$on("orderSummaryContextChanged",function(t,i){if(o("orderSummaryContextChanging"),i&&(i.updateCartItem||i.removeCartItem)){n.$broadcast("resetOrderSummaryData");n.$broadcast("resetPaymentMethodsData");(u.ajaxUpdateShippingMethodsOnCartUpdate||i.removeCartItem)&&n.$broadcast("resetShippingMethodsData");i.removeCartItem&&n.$broadcast("resetCheckoutAttributesData");return}f()}),n.$on("orderTotalContextChanged",function(t,i){i&&i.hasProductsRequiringShipping==!1&&n.$broadcast("togglePanel",{hasProductsRequiringShipping:i.hasProductsRequiringShipping});f("OrderTotalController")}),n.$on("discountBoxContextChanging",function(n,i){e.push("discountBoxContextChanging");i&&(i.applyDiscountCode||i.removeDiscountCode)&&t.raiseEvents(["setDiscountBoxOverlay","setOrderTotalOverlay"])}),n.$on("discountBoxContextChanged",function(i,r){o("discountBoxContextChanging");r&&(r.isDiscountApplied||r.isDiscountRemoved)&&(t.raiseEvents(["setPaymentMethodsOverlay","setShippingMethodsOverlay","setOrderSummaryOverlay"]),n.$broadcast("resetPaymentMethodsData"),n.$broadcast("resetShippingMethodsData"),n.$broadcast("resetOrderSummaryData"));f("DiscountBoxController")}),n.$on("giftCardBoxContextChanging",function(n,i){e.push("giftCardBoxContextChanging");i&&(i.applyGiftCard||i.removeGiftCard)&&t.raiseEvents(["setGiftCardBoxOverlay","setOrderTotalOverlay"])}),n.$on("giftCardBoxContextChanged",function(i,r){o("giftCardBoxContextChanging");r&&(r.isGiftCardApplied||r.isGiftCardRemoved)&&(t.raiseEvents(["setPaymentMethodsOverlay"]),n.$broadcast("resetPaymentMethodsData"));f("GiftCardBoxController")}),n.$on("removeGiftCard",function(t,i){i.giftCardId&&n.$broadcast("removeGiftCardById",{giftCardId:i.giftCardId})}),n.$on("estimateShippingContextChanging",function(n,i){i&&t.raiseEvents(["setEstimateShippingOverlay"])}),n.$on("estimateShippingContextChanged",function(){f("EstimateShippingController")}),n.$on("checkoutAttributesContextChanging",function(n,i){g(i)&&(e.push("checkoutAttributesContextChanging"),t.raiseEvents(["setOrderTotalOverlay"]));t.raiseEvents(["setCheckoutAttributesOverlay"])}),n.$on("checkoutAttributesContextChanged",function(i,r){it(r)&&(t.raiseEvents(["setPaymentMethodsOverlay"]),n.$broadcast("resetPaymentMethodsData"));g(r)&&o("checkoutAttributesContextChanging");f("CheckoutAttributesController")}),n.$on("confirmOrderContextChanging",function(){t.raiseEvents(["setConfirmOrderOverlay"])}),n.$on("confirmOrderContextChanged",function(){n.$broadcast("hideConfirmOrderOverlay");f("OrderConfirmController")}),n.$on("pickupInStoreContextChanging",function(){e.push("pickupInStoreContextChanging");n.$broadcast("setOrderTotalOverlay")}),n.$on("pickupInStoreContextChanged",function(i,r){o("pickupInStoreContextChanging");t.raiseEvents(["setPaymentMethodsOverlay","resetPaymentMethodsData"]);n.$broadcast("togglePanel",{pickUpInStore:r.pickupInStore});r.pickupInStore||t.raiseEvents(["setShippingMethodsOverlay","resetShippingMethodsData"]);f("PickupInStoreController")}),n.$on("errorOccured",function(t,i){i&&n.$broadcast("pushError",i)}),n.$on("submitForm",function(t,i){i&&n.$broadcast("submit")}),{}}angular.module("realOnePageCheckout.dispatchers").factory("dataDispatcher",dataDispatcher);dataDispatcher.$inject=["$rootScope","objectUtility","namedQueueUtility","dataService"];